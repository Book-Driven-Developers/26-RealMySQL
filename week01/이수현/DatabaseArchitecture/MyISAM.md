# 4.3 MyISAM 스토리지 엔진 아키텍처

MyISAM은 과거 MySQL의 기본 스토리지 엔진이었으며  
**트랜잭션을 지원하지 않는 대신 읽기 성능이 빠른 엔진**이다.

---

## 4.3.1 키 캐시 (Key Cache)

<details>
<summary>자세히 보기</summary>

### 키 캐시란?

MyISAM의 **인덱스 전용 캐시 영역**

👉 InnoDB의 버퍼 풀과 달리  
👉 **데이터는 캐싱하지 않고 인덱스만 캐싱**

---

### 동작 방식

1. 인덱스 블록을 메모리에 저장
2. 검색 시 디스크 대신 메모리에서 조회
3. 인덱스 변경 시 캐시 업데이트

---

### 설정 확인

```sql
SHOW VARIABLES LIKE 'key_buffer_size';
```

---

### 특징

- MyISAM 성능은 key_buffer_size에 크게 의존
- 데이터는 OS 캐시에 의존
- 랜덤 읽기 성능은 인덱스 캐시 크기에 영향

---

### InnoDB와 차이

| 항목 | MyISAM | InnoDB |
|------|--------|--------|
| 캐시 대상 | 인덱스만 | 데이터 + 인덱스 |
| 메모리 의존 | key cache | buffer pool |

</details>

---

## 4.3.2 운영체제의 캐시 및 버퍼

<details>
<summary>자세히 보기</summary>

MyISAM은 **데이터 파일을 OS 캐시에 의존**한다.

---

### 구조

- 인덱스 → MySQL Key Cache
- 데이터 → OS Page Cache

---

### 의미

- MySQL이 데이터 캐싱을 직접 관리하지 않음
- 운영체제의 메모리 정책에 성능 영향 받음

---

### 장점

- 구조 단순
- 메모리 사용량 예측 쉬움

---

### 단점

- 데이터 접근 성능이 OS 상태에 따라 달라짐
- 튜닝 범위 제한적
- InnoDB보다 세밀한 메모리 관리 불가

</details>

---

## 4.3.3 데이터 파일과 프라이머리 키(인덱스) 구조

<details>
<summary>자세히 보기</summary>

### 파일 구조

MyISAM은 테이블당 3개 파일 사용

| 파일 | 역할 |
|------|------|
| .frm | 테이블 정의 |
| .MYD | 데이터 파일 |
| .MYI | 인덱스 파일 |

---

### 인덱스 구조

- B-Tree 구조
- 프라이머리 키도 일반 보조 인덱스와 동일 구조
- 클러스터링 구조가 아님

👉 PK가 데이터 정렬 기준이 아님

---

### 특징

- 인덱스 → 데이터 파일의 물리적 위치(포인터) 저장
- PK 검색 시:
    1. 인덱스 조회
    2. 데이터 파일 접근

👉 InnoDB보다 한 단계 추가 접근 필요

---

### 락 구조

- 테이블 단위 Lock
- 동시 쓰기 성능 낮음

---

### Crash Recovery

- 트랜잭션 미지원
- 장애 발생 시 데이터 손상 가능
- REPAIR TABLE 필요할 수 있음

</details>

---

# MyISAM 핵심 정리

| 항목 | MyISAM |
|------|--------|
| 트랜잭션 | ❌ |
| 외래 키 | ❌ |
| 락 | 테이블 단위 |
| 캐시 | 인덱스만 |
| Crash Recovery | ❌ |
| 클러스터 인덱스 | ❌ |

---

# InnoDB vs MyISAM 구조적 차이 요약

| 구분 | InnoDB | MyISAM |
|------|--------|--------|
| 기본 엔진 | O | X |
| 트랜잭션 | O | X |
| 데이터 저장 | PK 기준 정렬 | 파일 별도 저장 |
| 캐시 | Buffer Pool | Key Cache |
| 동시성 | Row Lock | Table Lock |
| 복구 기능 | 자동 | 수동 |

---

👉 결론:  
실제 서비스 환경에서는 대부분 InnoDB 사용  
MyISAM은 읽기 중심 로그성 데이터나 특수 목적에 제한적으로 사용

